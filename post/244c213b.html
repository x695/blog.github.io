<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0"><link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.4.0",sidebar:{position:"right",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="常用工作笔记"><meta property="og:type" content="article"><meta property="og:title" content="CHAMC工作笔记"><meta property="og:url" content="https://www.yangshixian.me/post/244c213b.html"><meta property="og:site_name" content="贤时间"><meta property="og:description" content="常用工作笔记"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2018-08-28T01:50:20.920Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CHAMC工作笔记"><meta name="twitter:description" content="常用工作笔记"><link rel="canonical" href="https://www.yangshixian.me/post/244c213b.html"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>CHAMC工作笔记 | 贤时间</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e9e0522e03619414569b738e58baed9a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">贤时间</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">为天地立心，为生民立命，为往圣继绝学，为万世开太平</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.yangshixian.me/post/244c213b.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Young"><meta itemprop="description" content=""><meta itemprop="image" content="https://i.imgur.com/ApfnYA5.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="贤时间"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CHAMC工作笔记</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-08-27 15:48:00" itemprop="dateCreated datePublished" datetime="2018-08-27T15:48:00+08:00">2018-08-27</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-08-28 09:50:20" itemprop="dateModified" datetime="2018-08-28T09:50:20+08:00">2018-08-28</time></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <a href="/post/244c213b.html#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span><span class="post-comments-count valine-comment-count" data-xid="/post/244c213b.html" itemprop="commentCount"></span></a></span> <span id="/post/244c213b.html" class="leancloud_visitors" data-flag-title="CHAMC工作笔记"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">15k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">13 分钟</span></div><div class="post-description">常用工作笔记</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="报表类"><a href="#报表类" class="headerlink" title="报表类"></a>报表类</h2><a id="more"></a><h3 id="两类减值计提报表"><a href="#两类减值计提报表" class="headerlink" title="两类减值计提报表"></a>两类减值计提报表</h3><pre><code>chamc_devalue_proviston_pkg
</code></pre><h3 id="总分核对"><a href="#总分核对" class="headerlink" title="总分核对"></a>总分核对</h3><pre><code>XXT_GL_SL_CHECK_RPT_PKG.main
</code></pre><h3 id="现金流表项刷数程序"><a href="#现金流表项刷数程序" class="headerlink" title="现金流表项刷数程序"></a>现金流表项刷数程序</h3><pre><code>CHAMC_CF_SETUP_PKG.CHAMC_MAIN_P
</code></pre><h3 id="抽取程序"><a href="#抽取程序" class="headerlink" title="抽取程序"></a>抽取程序</h3><pre><code>chamc_cl_csl_refresh_new_pkg
xxt_other_mode_pkg
</code></pre><h3 id="或有负债余额统计表"><a href="#或有负债余额统计表" class="headerlink" title="或有负债余额统计表"></a>或有负债余额统计表</h3><pre><code>chamc_credit_addition_hdr_pkg
</code></pre><h3 id="科目余额表新-表内"><a href="#科目余额表新-表内" class="headerlink" title="科目余额表新 -表内"></a>科目余额表新 -表内</h3><pre><code>chamc_gl_acct_bal_detail_pkg_h
</code></pre><h2 id="APEX页面"><a href="#APEX页面" class="headerlink" title="APEX页面"></a>APEX页面</h2><h3 id="批量审核查询"><a href="#批量审核查询" class="headerlink" title="批量审核查询"></a>批量审核查询</h3><p> 200-110</p><h3 id="批量审核查询》集合式报账单"><a href="#批量审核查询》集合式报账单" class="headerlink" title="批量审核查询》集合式报账单"></a>批量审核查询》集合式报账单</h3><p>200-107</p><h3 id="回款计划展期按钮"><a href="#回款计划展期按钮" class="headerlink" title="回款计划展期按钮"></a>回款计划展期按钮</h3><p> 117-235</p><h3 id="回款计划报账单"><a href="#回款计划报账单" class="headerlink" title="回款计划报账单"></a>回款计划报账单</h3><p>200-207</p><h3 id="减值变动"><a href="#减值变动" class="headerlink" title="减值变动"></a>减值变动</h3><p>200-232</p><h3 id="或有负债"><a href="#或有负债" class="headerlink" title="或有负债"></a>或有负债</h3><p>600-302</p><h2 id="预分录-会计引擎"><a href="#预分录-会计引擎" class="headerlink" title="预分录-会计引擎"></a>预分录-会计引擎</h2><h3 id="总入口"><a href="#总入口" class="headerlink" title="总入口"></a>总入口</h3><pre><code>chamc_batch_create_sl_pkg
</code></pre><h3 id="撤回总入口"><a href="#撤回总入口" class="headerlink" title="撤回总入口"></a>撤回总入口</h3><pre><code>xxt_npa_recall_pkg
</code></pre><h3 id="预分录总入口包"><a href="#预分录总入口包" class="headerlink" title="预分录总入口包"></a>预分录总入口包</h3><pre><code>chamc_cux_ois_int_pkg
</code></pre><h2 id="报账单生成事务"><a href="#报账单生成事务" class="headerlink" title="报账单生成事务"></a>报账单生成事务</h2><h3 id="股权建账"><a href="#股权建账" class="headerlink" title="股权建账"></a>股权建账</h3><pre><code>Chamc_Cux_Equity_New_Pkg
</code></pre><h3 id="生成撤回预分录总校验包"><a href="#生成撤回预分录总校验包" class="headerlink" title="生成撤回预分录总校验包"></a>生成撤回预分录总校验包</h3><pre><code>chamc_check_batch_pkg
</code></pre><h3 id="回款计划导入"><a href="#回款计划导入" class="headerlink" title="回款计划导入"></a>回款计划导入</h3><pre><code>chamc_return_plan_import_pkg
</code></pre><h3 id="投放计划导入"><a href="#投放计划导入" class="headerlink" title="投放计划导入"></a>投放计划导入</h3><pre><code>chamc_project_putin_import_pkg.chamc_process_main_p
</code></pre><h3 id="或有负债导入事务"><a href="#或有负债导入事务" class="headerlink" title="或有负债导入事务"></a>或有负债导入事务</h3><pre><code>xxt_ob_credit_addition_pkg.pro_ob_credit_addition_entity
chamc_ob_credit_add_int_pkg.chamc_insert_table_p
</code></pre><h3 id="报表-表外业务事项"><a href="#报表-表外业务事项" class="headerlink" title="报表-表外业务事项"></a>报表-表外业务事项</h3><pre><code>chamc_obs_stat_rpt_pkg
</code></pre><h3 id="客商导入程序"><a href="#客商导入程序" class="headerlink" title="客商导入程序"></a>客商导入程序</h3><pre><code>chamc_baisc_cust_import_pkg
</code></pre><h3 id="业务系统db-link联查资产编号"><a href="#业务系统db-link联查资产编号" class="headerlink" title="业务系统db_link联查资产编号"></a>业务系统db_link联查资产编号</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WITH asset AS</span><br><span class="line"> (<span class="keyword">SELECT</span>  <span class="comment">/*+ materialize */</span>   <span class="string">"asset_number"</span> asset_number</span><br><span class="line">    <span class="keyword">FROM</span> chamc_asset_reduce_int@mssql_datasyncdb_pub.chamc.com.cn</span><br><span class="line">   <span class="keyword">WHERE</span> <span class="string">"header_id"</span> <span class="keyword">IN</span></span><br><span class="line">         (<span class="keyword">SELECT</span> <span class="string">"BILL_ID"</span></span><br><span class="line">            <span class="keyword">FROM</span> busi_bill_synstatus@mssql_datasyncdb_pub.chamc.com.cn</span><br><span class="line">           <span class="keyword">WHERE</span> <span class="string">"BUSI_ID"</span> = <span class="number">103957</span></span><br><span class="line">             <span class="keyword">AND</span> <span class="string">"BILL_TYPE"</span> = <span class="string">'FIAS_DIPOSAL'</span>))</span><br><span class="line"><span class="keyword">SELECT</span> flv.*</span><br><span class="line">  <span class="keyword">FROM</span> apps.fnd_lookup_values_vl flv,</span><br><span class="line">       asset</span><br><span class="line"> <span class="keyword">WHERE</span> flv.meaning = asset.asset_number;</span><br></pre></td></tr></table></figure><h3 id="查资产映射"><a href="#查资产映射" class="headerlink" title="查资产映射"></a>查资产映射</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> flv.meaning 项目系统资产编号,flv.tag 财务资产编号</span><br><span class="line">    <span class="comment">-- INTO l_ora_asset</span></span><br><span class="line">     <span class="keyword">FROM</span> apps.fnd_lookup_values_vl flv</span><br><span class="line">    <span class="keyword">WHERE</span> flv.lookup_type = <span class="string">'CHAMC_FINASSET_NUM_MAP'</span></span><br><span class="line">      <span class="keyword">AND</span> flv.enabled_flag = <span class="string">'Y'</span></span><br><span class="line">      <span class="keyword">AND</span> flv.meaning <span class="keyword">IN</span> (<span class="string">'16141920000600000001'</span>, <span class="string">'16141920000700000001'</span>);</span><br></pre></td></tr></table></figure><h3 id="查coa"><a href="#查coa" class="headerlink" title="查coa"></a>查coa</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> description CHAMC_COA_ACC, flex_value</span><br><span class="line">  <span class="keyword">FROM</span> apps.FND_FLEX_VALUES_VL</span><br><span class="line"> <span class="keyword">WHERE</span> FLEX_VALUE_SET_ID =</span><br><span class="line">       (<span class="keyword">SELECT</span> FLEX_VALUE_SET_ID</span><br><span class="line">          <span class="keyword">FROM</span> apps.FND_FLEX_VALUE_SETS</span><br><span class="line">         <span class="keyword">WHERE</span> FLEX_VALUE_SET_NAME = <span class="string">'CHAMC_COA_ACC'</span>)</span><br><span class="line">       <span class="keyword">AND</span> ENABLED_FLAG = <span class="string">'Y'</span></span><br><span class="line">       <span class="keyword">AND</span> <span class="keyword">SYSDATE</span> <span class="keyword">BETWEEN</span> NVL(START_DATE_ACTIVE, <span class="keyword">SYSDATE</span> - <span class="number">1</span>) <span class="keyword">AND</span></span><br><span class="line">       NVL(END_DATE_ACTIVE, <span class="keyword">SYSDATE</span> + <span class="number">1</span>)</span><br><span class="line">       <span class="keyword">AND</span> SUMMARY_FLAG = <span class="string">'N'</span></span><br></pre></td></tr></table></figure><h3 id="减值变动导入事务"><a href="#减值变动导入事务" class="headerlink" title="减值变动导入事务"></a>减值变动导入事务</h3><pre><code>chamc_validate_impair_pkg
</code></pre><h2 id="EBS-操作"><a href="#EBS-操作" class="headerlink" title="EBS 操作"></a>EBS 操作</h2><h3 id="请求集"><a href="#请求集" class="headerlink" title="请求集"></a>请求集</h3><p>CHAMC_GL_ACC_HIERARCHY</p><h2 id="常用视图和表"><a href="#常用视图和表" class="headerlink" title="常用视图和表"></a>常用视图和表</h2><h3 id="资产余额"><a href="#资产余额" class="headerlink" title="资产余额"></a>资产余额</h3><pre><code>SELECT * FROM apps.chamc_cost_details_v dv WHERE dv.asset_id ;
SELECT * FROM apps.chamc_cost_balance_v bv WHERE bv.asset_id;
cux_ois_accounting_entries
</code></pre><h3 id="摊余应计利息"><a href="#摊余应计利息" class="headerlink" title="摊余应计利息"></a>摊余应计利息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> cux.chamc_cashflow_accounts    a,</span><br><span class="line">       cux.chamc_cashflow_headers_his h</span><br><span class="line"> <span class="keyword">WHERE</span> a.cashflow_history_id = h.cashflow_history_id</span><br><span class="line">   <span class="keyword">AND</span> h.biz_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> v.ASSET_ID</span><br><span class="line">                      <span class="keyword">FROM</span> apps.chamc_asset_v v</span><br><span class="line">                     <span class="keyword">WHERE</span> v.ASSET_NUMBER = <span class="string">'06140037-2-表外'</span>);</span><br><span class="line">                     </span><br><span class="line"><span class="keyword">SELECT</span> a.*</span><br><span class="line">  <span class="keyword">FROM</span> cux.chamc_cashflow_accounts    a,</span><br><span class="line">       cux.chamc_cashflow_headers_his h</span><br><span class="line"> <span class="keyword">WHERE</span> a.cashflow_history_id = h.cashflow_history_id</span><br><span class="line">   <span class="keyword">AND</span> h.biz_id =     </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">  <span class="comment">--关联到总账</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="comment">/* sum(l.entered_dr - l.entered_cr)*/</span></span><br><span class="line"> E.PERIOD_NAME,</span><br><span class="line"> L.ENTERED_DR,</span><br><span class="line"> L.ENTERED_CR,</span><br><span class="line"> e.status,</span><br><span class="line"> aa.account_type,</span><br><span class="line"> aa.cashflow_account_id,</span><br><span class="line"> <span class="keyword">round</span>(aa.account_amount, <span class="number">2</span>) 利息事务金额,</span><br><span class="line"> <span class="keyword">decode</span>(aa.in_bs_flag, <span class="string">'Y'</span>, <span class="string">'表内'</span>, <span class="string">'表外'</span>) 利息事务上表内外标识,</span><br><span class="line"> <span class="comment">--aa.*,</span></span><br><span class="line"> <span class="keyword">DECODE</span>(L.SEGMENT3,</span><br><span class="line">        <span class="string">'1506020101'</span>,</span><br><span class="line">        <span class="string">'应收款项类投资-应计利息'</span>,</span><br><span class="line">        <span class="string">'6111050101'</span>,</span><br><span class="line">        <span class="string">'投资收益-应收款项类投资-持有期间'</span>,</span><br><span class="line">        <span class="string">'8015020101'</span>,</span><br><span class="line">        <span class="string">'逾期转表外-应计收益'</span>,</span><br><span class="line">        <span class="string">'9015020101'</span>,</span><br><span class="line">        <span class="string">'逾期转表外备抵-应收收益'</span>) 科目</span><br><span class="line">  <span class="keyword">FROM</span> cux.xxt_sl_events e,</span><br><span class="line">       cux.xxt_sl_entry_lines l,</span><br><span class="line">       cux.xxt_sl_entity_relatns r,</span><br><span class="line">       (<span class="keyword">SELECT</span> a.*</span><br><span class="line">          <span class="keyword">FROM</span> cux.chamc_cashflow_accounts    a,</span><br><span class="line">               cux.chamc_cashflow_headers_his h</span><br><span class="line">         <span class="keyword">WHERE</span> a.cashflow_history_id = h.cashflow_history_id</span><br><span class="line">           <span class="keyword">AND</span> h.biz_id <span class="keyword">IN</span></span><br><span class="line">               (<span class="keyword">SELECT</span> v.ASSET_ID</span><br><span class="line">                  <span class="keyword">FROM</span> apps.chamc_asset_v v</span><br><span class="line">                 <span class="keyword">WHERE</span> v.ASSET_NUMBER = <span class="string">'22140079-1-表外'</span>)) aa</span><br><span class="line"> <span class="keyword">WHERE</span> e.event_id = l.event_id</span><br><span class="line">   <span class="keyword">AND</span> e.relation_id = r.relation_id</span><br><span class="line">   <span class="keyword">AND</span> r.relation_target = <span class="string">'EVENT'</span></span><br><span class="line">   <span class="keyword">AND</span> r.entity_type = <span class="string">'ACCRUED_INTEREST'</span></span><br><span class="line">   <span class="keyword">AND</span> r.entity_id = aa.cashflow_account_id</span><br><span class="line">   <span class="keyword">AND</span> ((aa.in_bs_flag = <span class="string">'Y'</span> <span class="keyword">AND</span> l.segment3 <span class="keyword">IN</span> (<span class="string">'8015020101'</span>, <span class="string">'9015020101'</span>)) <span class="keyword">OR</span></span><br><span class="line">       (aa.in_bs_flag = <span class="string">'N'</span> <span class="keyword">AND</span> l.segment3 <span class="keyword">IN</span> (<span class="string">'1506020101'</span>, <span class="string">'6111050101'</span>)))</span><br><span class="line"><span class="comment">-- AND e.period_name</span></span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> e.event_id;</span><br></pre></td></tr></table></figure><h3 id="资产证券化"><a href="#资产证券化" class="headerlink" title="资产证券化"></a>资产证券化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"> cp.project_number 项目编号,</span><br><span class="line"> cp.project_name,</span><br><span class="line"> t.asset_pool_name 资产池名称,</span><br><span class="line"> cat.abs_asset_number 资产池编号,</span><br><span class="line"> ai.*</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FROM</span> cux.chamc_restru_new_obligations o,</span><br><span class="line">       cux.chamc_abs_asset_int          ai,</span><br><span class="line">       cux.chamc_abs_asset_trans        cat,</span><br><span class="line">       cux.chamc_abs_asset_pool_trans   t,</span><br><span class="line">       cux.chamc_projects               cp</span><br><span class="line"> <span class="keyword">WHERE</span> o.sheet_business_type <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">   <span class="keyword">AND</span> cat.source_code = <span class="string">'CHAMC_ABS_ASSET_INT'</span></span><br><span class="line">   <span class="keyword">AND</span> cat.source_id = ai.header_id</span><br><span class="line">   <span class="keyword">AND</span> o.obligatory_number = ai.abs_asset_number</span><br><span class="line">   <span class="keyword">AND</span> cat.asset_pool_trans_id = t.transfer_id</span><br><span class="line">   <span class="keyword">AND</span> o.project_id = cp.project_id</span><br><span class="line">   <span class="keyword">AND</span> t.asset_pool_name <span class="keyword">LIKE</span> <span class="string">'%浦发%'</span></span><br><span class="line">   <span class="keyword">AND</span> cp.project_number <span class="keyword">IN</span> (<span class="string">'04130088'</span>,</span><br><span class="line">                             <span class="string">'04130094'</span>,</span><br><span class="line">                             <span class="string">'05140028'</span>,</span><br><span class="line">                             <span class="string">'05140042'</span>,</span><br><span class="line">                             <span class="string">'06130009'</span>,</span><br><span class="line">                             <span class="string">'20140093'</span>,</span><br><span class="line">                             <span class="string">'05120061'</span>);</span><br></pre></td></tr></table></figure><h3 id="附件程序"><a href="#附件程序" class="headerlink" title="附件程序"></a>附件程序</h3><pre><code>CHAMC_ATTACHMENT_PKG.CHAMC_PUBLIC_SAVE_P
</code></pre><h2 id="摊余成本-amp-amp-应收利息"><a href="#摊余成本-amp-amp-应收利息" class="headerlink" title="摊余成本 &amp;&amp; 应收利息"></a>摊余成本 &amp;&amp; 应收利息</h2><h3 id="摊余成本批量创建预分录"><a href="#摊余成本批量创建预分录" class="headerlink" title="摊余成本批量创建预分录"></a>摊余成本批量创建预分录</h3><p>XXT_CASHFLOW_PRE_ACCOUNT</p><pre><code>XXT_CASHFLOW_BATCH_IMP_PKG.sl_acct_batch
</code></pre><h3 id="摊余成本批量传总账"><a href="#摊余成本批量传总账" class="headerlink" title="摊余成本批量传总账"></a>摊余成本批量传总账</h3><p>XXT_CASHFLOW_IMPORT_GL</p><pre><code>XXT_CASHFLOW_BATCH_IMP_PKG.import_gl_batch
</code></pre><h3 id="二者合包"><a href="#二者合包" class="headerlink" title="二者合包"></a>二者合包</h3><pre><code>chamc_ifrs9_run_pkg
</code></pre><h2 id="营改增"><a href="#营改增" class="headerlink" title="营改增"></a>营改增</h2><h3 id="查是否应该计税"><a href="#查是否应该计税" class="headerlink" title="查是否应该计税"></a>查是否应该计税</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> h.plan_return_header_id,</span><br><span class="line">       l.line_num              行号,</span><br><span class="line">       l.return_amount         回息金额,</span><br><span class="line">       <span class="comment">/* l.vat_overdue_flag 欠息标识,*/</span></span><br><span class="line">       l.return_date 回款日期</span><br><span class="line">  <span class="keyword">FROM</span> cux.chamc_return_plan_headers h,</span><br><span class="line">       cux.chamc_return_plan_lines   l</span><br><span class="line"> <span class="keyword">WHERE</span> h.plan_return_header_id = l.plan_return_header_id</span><br><span class="line">      <span class="comment">/*AND h.biz_id = 1017953*/</span></span><br><span class="line">   <span class="keyword">AND</span> h.project_id = <span class="number">1000973</span></span><br><span class="line">   <span class="keyword">AND</span> l.return_type = <span class="string">'INTEREST'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="comment">/* NVL(SUM(nvl(CDR.INTEREST_AMOUNT, 0)), 0)*/</span></span><br><span class="line"> crh.asset_number    资产编号,</span><br><span class="line"> crh.gl_date         回收通知单总账日期,</span><br><span class="line"> cdr.interest_amount 债务人还息金额,</span><br><span class="line"> crh.total_amount    还款总额</span><br><span class="line"><span class="comment">/*  INTO v_rec_interest_amt_total*/</span></span><br><span class="line">  <span class="keyword">FROM</span> cux.CHAMC_RECYCLE_HEADER_INT    CRH,</span><br><span class="line">       cux.CHAMC_DBT_RETURN_DETAIL_INT CDR</span><br><span class="line"> <span class="keyword">WHERE</span> CRH.HEADER_ID = CDR.HEADER_ID</span><br><span class="line">   <span class="keyword">AND</span> CRH.RECYCLE_TYPE = <span class="string">'RET001'</span></span><br><span class="line">      <span class="comment">-- AND CRH.ORG_ID = 96</span></span><br><span class="line">   <span class="keyword">AND</span> CRH.ASSET_NUMBER = <span class="string">'22140020-1'</span></span><br><span class="line">   <span class="keyword">AND</span> CRH.APPROVE_STATUS = <span class="string">'SECOND_APPROVED'</span></span><br><span class="line">   <span class="keyword">AND</span> TO_CHAR(CRH.GL_DATE, <span class="string">'YYYY-MM'</span>) &lt;= <span class="string">'2018-03'</span></span><br><span class="line"><span class="comment">/*AND CRH.GL_DATE &gt;= gc_calc_date*/</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure><h2 id="标准模块"><a href="#标准模块" class="headerlink" title="标准模块"></a>标准模块</h2><h3 id="获取客商地点id"><a href="#获取客商地点id" class="headerlink" title="获取客商地点id"></a>获取客商地点id</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> hcsu.site_use_id </span><br><span class="line">       <span class="keyword">FROM</span> apps.hz_cust_site_uses_all  hcsu,</span><br><span class="line">            apps.hz_cust_acct_sites_all hcas,</span><br><span class="line">            apps.hz_cust_accounts       hca</span><br><span class="line">      <span class="keyword">WHERE</span> hcsu.cust_acct_site_id = hcas.cust_acct_site_id</span><br><span class="line">        <span class="keyword">AND</span> hcas.cust_account_id = hca.cust_account_id</span><br><span class="line">        <span class="keyword">AND</span> hca.account_number = p_cust_number</span><br><span class="line">        <span class="keyword">AND</span> hcsu.org_id = p_org_id;</span><br></pre></td></tr></table></figure><h3 id="请求在哪个职责下"><a href="#请求在哪个职责下" class="headerlink" title="请求在哪个职责下"></a>请求在哪个职责下</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> z1 <span class="string">"职责"</span>,</span><br><span class="line">       z2 <span class="string">"请求组"</span>,</span><br><span class="line">       z3 <span class="string">"请求"</span></span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> res.RESPONSIBILITY_NAME         z1,</span><br><span class="line">               RG.REQUEST_GROUP_NAME           z2,</span><br><span class="line">               RV.USER_CONCURRENT_PROGRAM_NAME z3</span><br><span class="line">          <span class="keyword">FROM</span> FND_RESPONSIBILITY_VL      res,</span><br><span class="line">               FND_REQUEST_GROUP_UNITS    rgu,</span><br><span class="line">               FND_CONCURRENT_PROGRAMS_VL RV,</span><br><span class="line">               FND_REQUEST_GROUPS         RG</span><br><span class="line">         <span class="keyword">WHERE</span> rgu.request_unit_type = <span class="string">'P'</span></span><br><span class="line">           <span class="keyword">AND</span> res.CREATION_DATE &gt; <span class="keyword">to_date</span>(<span class="string">'2011-01-01'</span>, <span class="string">'yyyy-mm-dd'</span>)</span><br><span class="line">           <span class="keyword">AND</span> RES.APPLICATION_ID = RGU.APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RES.REQUEST_GROUP_ID = RGU.REQUEST_GROUP_ID</span><br><span class="line">           <span class="keyword">AND</span> RV.APPLICATION_ID = RGU.UNIT_APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RV.CONCURRENT_PROGRAM_ID = rgu.request_unit_id</span><br><span class="line">           <span class="keyword">AND</span> RG.Application_Id = RES.APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RG.REQUEST_GROUP_ID = RGU.REQUEST_GROUP_ID</span><br><span class="line">        <span class="keyword">UNION</span> ALL</span><br><span class="line">        <span class="keyword">SELECT</span> res.RESPONSIBILITY_NAME z1,</span><br><span class="line">               RG.REQUEST_GROUP_NAME,</span><br><span class="line">               RV.USER_CONCURRENT_PROGRAM_NAME</span><br><span class="line">          <span class="keyword">FROM</span> FND_RESPONSIBILITY_VL      res,</span><br><span class="line">               FND_REQUEST_GROUP_UNITS    rgu,</span><br><span class="line">               FND_CONCURRENT_PROGRAMS_VL RV,</span><br><span class="line">               FND_REQUEST_GROUPS         RG</span><br><span class="line">         <span class="keyword">WHERE</span> rgu.request_unit_type = <span class="string">'A'</span></span><br><span class="line">           <span class="keyword">AND</span> res.CREATION_DATE &gt; <span class="keyword">to_date</span>(<span class="string">'2011-01-01'</span>, <span class="string">'yyyy-mm-dd'</span>)</span><br><span class="line">           <span class="keyword">AND</span> RES.APPLICATION_ID = RGU.APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RES.REQUEST_GROUP_ID = RGU.REQUEST_GROUP_ID</span><br><span class="line">           <span class="keyword">AND</span> RV.APPLICATION_ID = RGU.UNIT_APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RG.Application_Id = RES.APPLICATION_ID</span><br><span class="line">           <span class="keyword">AND</span> RG.REQUEST_GROUP_ID = RGU.REQUEST_GROUP_ID</span><br><span class="line">        </span><br><span class="line">        )</span><br><span class="line"> <span class="keyword">WHERE</span> z3 <span class="keyword">LIKE</span> <span class="string">'%CHAMC_台账刷数据请求%'</span></span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> z1;</span><br></pre></td></tr></table></figure><h2 id="大数据迁移-表》表"><a href="#大数据迁移-表》表" class="headerlink" title="大数据迁移 表》表"></a>大数据迁移 表》表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#源端</span></span><br><span class="line">sql&gt;create directory dump_oratst as <span class="string">'/app/PROD/oraprod/dump_data'</span>;</span><br><span class="line">expdp apps/apps TABLES=TMP_TSR_INTEREST dumpfile=TMP_TSR_INTEREST.dmp DIRECTORY=dump_oratst;</span><br><span class="line"></span><br><span class="line"><span class="comment">#目标端</span></span><br><span class="line">sql&gt;create directory dump_oratst as <span class="string">'/app/PROD/oraprod/dump_data'</span>;</span><br><span class="line">impdp apps/apps DIRECTORY=dump_oratst DUMPFILE=TMP_TSR_INTEREST.dmp ;</span><br></pre></td></tr></table></figure><h3 id="台总对账"><a href="#台总对账" class="headerlink" title="台总对账"></a>台总对账</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">with zongzhang as</span><br><span class="line"> (<span class="keyword">select</span> v.branch_code,</span><br><span class="line">         v.branch_name,</span><br><span class="line">         v.account_code,</span><br><span class="line">         v.account_name,</span><br><span class="line">         v.item_code,</span><br><span class="line">         v.item_name,</span><br><span class="line">         v.biz_code,</span><br><span class="line">         v.biz_name,</span><br><span class="line">         <span class="keyword">sum</span>(v.DR_BAL_SUM_ORIGINAL - V.CR_BAL_SUM_ORIGINAL) amount</span><br><span class="line">    <span class="keyword">from</span> ods.Chamc_Acct_Balances_v v</span><br><span class="line">   <span class="keyword">where</span> v.period_name = <span class="string">'2016-12'</span></span><br><span class="line">     <span class="keyword">and</span> v.DR_BAL_SUM_ORIGINAL &lt;&gt; V.CR_BAL_SUM_ORIGINAL</span><br><span class="line">     <span class="keyword">and</span> v.account_code <span class="keyword">in</span> (<span class="string">'1101010101'</span>,</span><br><span class="line">                            <span class="string">'1101020101'</span>,</span><br><span class="line">                            <span class="string">'1111010101'</span>,</span><br><span class="line">                            <span class="string">'1111020101'</span>,</span><br><span class="line">                            <span class="string">'1111999999'</span>,</span><br><span class="line">                            <span class="string">'1132020101'</span>,</span><br><span class="line">                            <span class="string">'1132030101'</span>,</span><br><span class="line">                            <span class="string">'1132040101'</span>,</span><br><span class="line">                            <span class="string">'1132050101'</span>,</span><br><span class="line">                            <span class="string">'1132080101'</span>,</span><br><span class="line">                            <span class="string">'1132999999'</span>,</span><br><span class="line">                            <span class="string">'1302010101'</span>,</span><br><span class="line">                            <span class="string">'1441040101'</span>,</span><br><span class="line">                            <span class="string">'1441060101'</span>,</span><br><span class="line">                            <span class="string">'1442040101'</span>,</span><br><span class="line">                            <span class="string">'1442060101'</span>,</span><br><span class="line">                            <span class="string">'1501010101'</span>,</span><br><span class="line">                            <span class="string">'1501020101'</span>,</span><br><span class="line">                            <span class="string">'1501030101'</span>,</span><br><span class="line">                            <span class="string">'1502010101'</span>,</span><br><span class="line">                            <span class="string">'1503010101'</span>,</span><br><span class="line">                            <span class="string">'1503010102'</span>,</span><br><span class="line">                            <span class="string">'1503030101'</span>,</span><br><span class="line">                            <span class="string">'1503040101'</span>,</span><br><span class="line">                            <span class="string">'1504010101'</span>,</span><br><span class="line">                            <span class="string">'1506010101'</span>,</span><br><span class="line">                            <span class="string">'1506020101'</span>,</span><br><span class="line">                            <span class="string">'1507010101'</span>,</span><br><span class="line">                            <span class="string">'1511010101'</span>,</span><br><span class="line">                            <span class="string">'1511020101'</span>,</span><br><span class="line">                            <span class="string">'1511020201'</span>,</span><br><span class="line">                            <span class="string">'1511020301'</span>,</span><br><span class="line">                            <span class="string">'1511020401'</span>,</span><br><span class="line">                            <span class="string">'1512010101'</span>,</span><br><span class="line">                            <span class="string">'1512020101'</span>)</span><br><span class="line">   <span class="keyword">group</span> <span class="keyword">by</span> v.branch_code,</span><br><span class="line">            v.branch_name,</span><br><span class="line">            v.account_code,</span><br><span class="line">            v.account_name,</span><br><span class="line">            v.item_code,</span><br><span class="line">            v.item_name,</span><br><span class="line">            v.biz_code,</span><br><span class="line">            v.biz_name</span><br><span class="line">   <span class="keyword">order</span> <span class="keyword">by</span> v.item_code,</span><br><span class="line">            v.branch_code),</span><br><span class="line"></span><br><span class="line">yufenlu <span class="keyword">as</span></span><br><span class="line"> (<span class="keyword">select</span> cac.org_id,</span><br><span class="line">         CAC.ORG_NAME,</span><br><span class="line">         cac.account_code,</span><br><span class="line">         CAC.ACCOUNT_NAME,</span><br><span class="line">         cac.prject_code,</span><br><span class="line">         CAC.PRJECT_NAME,</span><br><span class="line">         cac.business_type_code,</span><br><span class="line">         CAC.BUSINESS_TYPE_NAME,</span><br><span class="line">         <span class="keyword">sum</span>(cac.dr_amount - cac.cr_amount) amount</span><br><span class="line">    <span class="keyword">from</span> ods.chamc_asset_coa_detail_v cac</span><br><span class="line">   <span class="keyword">where</span> TO_CHAR(<span class="keyword">TO_DATE</span>(cac.accounting_date), <span class="string">'YYYYMMDD'</span>) &lt;= <span class="string">'20161231'</span></span><br><span class="line">     <span class="keyword">and</span> cac.dr_amount &lt;&gt; cac.cr_amount</span><br><span class="line">     <span class="keyword">and</span> cac.account_code <span class="keyword">in</span> (<span class="string">'1101010101'</span>,</span><br><span class="line">                              <span class="string">'1101020101'</span>,</span><br><span class="line">                              <span class="string">'1111010101'</span>,</span><br><span class="line">                              <span class="string">'1111020101'</span>,</span><br><span class="line">                              <span class="string">'1111999999'</span>,</span><br><span class="line">                              <span class="string">'1132020101'</span>,</span><br><span class="line">                              <span class="string">'1132030101'</span>,</span><br><span class="line">                              <span class="string">'1132040101'</span>,</span><br><span class="line">                              <span class="string">'1132050101'</span>,</span><br><span class="line">                              <span class="string">'1132080101'</span>,</span><br><span class="line">                              <span class="string">'1132999999'</span>,</span><br><span class="line">                              <span class="string">'1302010101'</span>,</span><br><span class="line">                              <span class="string">'1441040101'</span>,</span><br><span class="line">                              <span class="string">'1441060101'</span>,</span><br><span class="line">                              <span class="string">'1442040101'</span>,</span><br><span class="line">                              <span class="string">'1442060101'</span>,</span><br><span class="line">                              <span class="string">'1501010101'</span>,</span><br><span class="line">                              <span class="string">'1501020101'</span>,</span><br><span class="line">                              <span class="string">'1501030101'</span>,</span><br><span class="line">                              <span class="string">'1502010101'</span>,</span><br><span class="line">                              <span class="string">'1503010101'</span>,</span><br><span class="line">                              <span class="string">'1503010102'</span>,</span><br><span class="line">                              <span class="string">'1503030101'</span>,</span><br><span class="line">                              <span class="string">'1503040101'</span>,</span><br><span class="line">                              <span class="string">'1504010101'</span>,</span><br><span class="line">                              <span class="string">'1506010101'</span>,</span><br><span class="line">                              <span class="string">'1506020101'</span>,</span><br><span class="line">                              <span class="string">'1507010101'</span>,</span><br><span class="line">                              <span class="string">'1511010101'</span>,</span><br><span class="line">                              <span class="string">'1511020101'</span>,</span><br><span class="line">                              <span class="string">'1511020201'</span>,</span><br><span class="line">                              <span class="string">'1511020301'</span>,</span><br><span class="line">                              <span class="string">'1511020401'</span>,</span><br><span class="line">                              <span class="string">'1512010101'</span>,</span><br><span class="line">                              <span class="string">'1512020101'</span>)</span><br><span class="line">   <span class="keyword">group</span> <span class="keyword">by</span> cac.org_id,</span><br><span class="line">            CAC.ORG_NAME,</span><br><span class="line">            cac.account_code,</span><br><span class="line">            CAC.ACCOUNT_NAME,</span><br><span class="line">            cac.prject_code,</span><br><span class="line">            CAC.PRJECT_NAME,</span><br><span class="line">            cac.business_type_code,</span><br><span class="line">            CAC.BUSINESS_TYPE_NAME</span><br><span class="line">   <span class="keyword">order</span> <span class="keyword">by</span> cac.prject_code,</span><br><span class="line">            cac.org_id)</span><br><span class="line"></span><br><span class="line"><span class="comment">--总账预分录勾稽不平的</span></span><br><span class="line"><span class="keyword">select</span> zongzhang.*,</span><br><span class="line">       yufenlu.amount <span class="keyword">as</span> yufenlu_amount</span><br><span class="line">  <span class="keyword">from</span> zongzhang,</span><br><span class="line">       yufenlu</span><br><span class="line"> <span class="keyword">where</span> zongzhang.branch_code = yufenlu.org_id</span><br><span class="line">   <span class="keyword">and</span> zongzhang.account_code = yufenlu.account_code</span><br><span class="line">   <span class="keyword">and</span> zongzhang.item_code = yufenlu.prject_code</span><br><span class="line">   <span class="keyword">and</span> zongzhang.biz_code = yufenlu.business_type_code</span><br><span class="line">   <span class="keyword">and</span> zongzhang.amount &lt;&gt; yufenlu.amount</span><br><span class="line">   <span class="keyword">AND</span> zongzhang.amount &lt;&gt; <span class="number">0</span></span><br><span class="line"><span class="keyword">UNION</span> ALL</span><br><span class="line"><span class="keyword">select</span> zongzhang.*,</span><br><span class="line">       yufenlu.amount</span><br><span class="line">  <span class="keyword">from</span> zongzhang</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> yufenlu</span><br><span class="line">    <span class="keyword">ON</span> zongzhang.branch_code = yufenlu.org_id</span><br><span class="line"> <span class="keyword">and</span> zongzhang.account_code = yufenlu.account_code</span><br><span class="line"> <span class="keyword">and</span> zongzhang.item_code = yufenlu.prject_code</span><br><span class="line"> <span class="keyword">and</span> zongzhang.biz_code = yufenlu.business_type_code</span><br><span class="line"> <span class="keyword">WHERE</span> yufenlu.account_code <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"> <span class="keyword">AND</span> zongzhang.amount &lt;&gt; <span class="number">0</span></span><br><span class="line"><span class="keyword">UNION</span> ALL</span><br><span class="line"><span class="keyword">select</span> yufenlu.org_id,</span><br><span class="line">       yufenlu.ORG_NAME,</span><br><span class="line">       yufenlu.account_code,</span><br><span class="line">       yufenlu.account_NAME,</span><br><span class="line">       yufenlu.prject_code,</span><br><span class="line">       yufenlu.prject_NAME,</span><br><span class="line">       yufenlu.business_type_code,</span><br><span class="line">       yufenlu.business_type_NAME,</span><br><span class="line">       zongzhang.amount,</span><br><span class="line">       yufenlu.amount</span><br><span class="line">  <span class="keyword">from</span> yufenlu</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> zongzhang</span><br><span class="line">    <span class="keyword">ON</span> zongzhang.branch_code = yufenlu.org_id</span><br><span class="line"> <span class="keyword">and</span> zongzhang.account_code = yufenlu.account_code</span><br><span class="line"> <span class="keyword">and</span> zongzhang.item_code = yufenlu.prject_code</span><br><span class="line"> <span class="keyword">and</span> zongzhang.biz_code = yufenlu.business_type_code</span><br><span class="line"> <span class="keyword">WHERE</span> zongzhang.account_code <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"> <span class="keyword">AND</span> yufenlu.amount &lt;&gt; <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/fc7ee163.html" rel="next" title="NPM包管理命令"><i class="fa fa-chevron-left"></i> NPM包管理命令</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/177574ba.html" rel="prev" title="HEXO_next主题 自带样式设置">HEXO_next主题 自带样式设置<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://i.imgur.com/ApfnYA5.jpg" alt="Young"><p class="site-author-name" itemprop="name">Young</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">4</span> <span class="site-state-item-name">标签</span></a></div></nav></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#报表类"><span class="nav-number">1.</span> <span class="nav-text">报表类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#两类减值计提报表"><span class="nav-number">1.1.</span> <span class="nav-text">两类减值计提报表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总分核对"><span class="nav-number">1.2.</span> <span class="nav-text">总分核对</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#现金流表项刷数程序"><span class="nav-number">1.3.</span> <span class="nav-text">现金流表项刷数程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽取程序"><span class="nav-number">1.4.</span> <span class="nav-text">抽取程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#或有负债余额统计表"><span class="nav-number">1.5.</span> <span class="nav-text">或有负债余额统计表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#科目余额表新-表内"><span class="nav-number">1.6.</span> <span class="nav-text">科目余额表新 -表内</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#APEX页面"><span class="nav-number">2.</span> <span class="nav-text">APEX页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#批量审核查询"><span class="nav-number">2.1.</span> <span class="nav-text">批量审核查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#批量审核查询》集合式报账单"><span class="nav-number">2.2.</span> <span class="nav-text">批量审核查询》集合式报账单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#回款计划展期按钮"><span class="nav-number">2.3.</span> <span class="nav-text">回款计划展期按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#回款计划报账单"><span class="nav-number">2.4.</span> <span class="nav-text">回款计划报账单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#减值变动"><span class="nav-number">2.5.</span> <span class="nav-text">减值变动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#或有负债"><span class="nav-number">2.6.</span> <span class="nav-text">或有负债</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#预分录-会计引擎"><span class="nav-number">3.</span> <span class="nav-text">预分录-会计引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#总入口"><span class="nav-number">3.1.</span> <span class="nav-text">总入口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#撤回总入口"><span class="nav-number">3.2.</span> <span class="nav-text">撤回总入口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#预分录总入口包"><span class="nav-number">3.3.</span> <span class="nav-text">预分录总入口包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#报账单生成事务"><span class="nav-number">4.</span> <span class="nav-text">报账单生成事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#股权建账"><span class="nav-number">4.1.</span> <span class="nav-text">股权建账</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成撤回预分录总校验包"><span class="nav-number">4.2.</span> <span class="nav-text">生成撤回预分录总校验包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#回款计划导入"><span class="nav-number">4.3.</span> <span class="nav-text">回款计划导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#投放计划导入"><span class="nav-number">4.4.</span> <span class="nav-text">投放计划导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#或有负债导入事务"><span class="nav-number">4.5.</span> <span class="nav-text">或有负债导入事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#报表-表外业务事项"><span class="nav-number">4.6.</span> <span class="nav-text">报表-表外业务事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#客商导入程序"><span class="nav-number">4.7.</span> <span class="nav-text">客商导入程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#业务系统db-link联查资产编号"><span class="nav-number">4.8.</span> <span class="nav-text">业务系统db_link联查资产编号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查资产映射"><span class="nav-number">4.9.</span> <span class="nav-text">查资产映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查coa"><span class="nav-number">4.10.</span> <span class="nav-text">查coa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#减值变动导入事务"><span class="nav-number">4.11.</span> <span class="nav-text">减值变动导入事务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EBS-操作"><span class="nav-number">5.</span> <span class="nav-text">EBS 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#请求集"><span class="nav-number">5.1.</span> <span class="nav-text">请求集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用视图和表"><span class="nav-number">6.</span> <span class="nav-text">常用视图和表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#资产余额"><span class="nav-number">6.1.</span> <span class="nav-text">资产余额</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#摊余应计利息"><span class="nav-number">6.2.</span> <span class="nav-text">摊余应计利息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资产证券化"><span class="nav-number">6.3.</span> <span class="nav-text">资产证券化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#附件程序"><span class="nav-number">6.4.</span> <span class="nav-text">附件程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#摊余成本-amp-amp-应收利息"><span class="nav-number">7.</span> <span class="nav-text">摊余成本 &amp;&amp; 应收利息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#摊余成本批量创建预分录"><span class="nav-number">7.1.</span> <span class="nav-text">摊余成本批量创建预分录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#摊余成本批量传总账"><span class="nav-number">7.2.</span> <span class="nav-text">摊余成本批量传总账</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二者合包"><span class="nav-number">7.3.</span> <span class="nav-text">二者合包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#营改增"><span class="nav-number">8.</span> <span class="nav-text">营改增</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查是否应该计税"><span class="nav-number">8.1.</span> <span class="nav-text">查是否应该计税</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标准模块"><span class="nav-number">9.</span> <span class="nav-text">标准模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取客商地点id"><span class="nav-number">9.1.</span> <span class="nav-text">获取客商地点id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#请求在哪个职责下"><span class="nav-number">9.2.</span> <span class="nav-text">请求在哪个职责下</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#大数据迁移-表》表"><span class="nav-number">10.</span> <span class="nav-text">大数据迁移 表》表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#台总对账"><span class="nav-number">10.1.</span> <span class="nav-text">台总对账</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Young</span></div><div class="footer-custom">Hosted by <a target="_blank" rel="external nofollow" href="https://pages.coding.me"><b>Coding Pages</b></a></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script><script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"8aukMvKjQI3Ex04xqeQ1wVpY-gzGzoHsz",appKey:"t3vhPJdmS29LgiKRYUHkGbiE",placeholder:"Just go go",avatar:"mm",meta:guest,pageSize:"10",visitor:!1})</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "khdUuKJFJVoW5iD1MRCt0QDd-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "khdUuKJFJVoW5iD1MRCt0QDd-gzGzoHsz",
                'X-LC-Key': "MCdW5elNJxo9oMwHLIT90ejJ",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script><script type="text/javascript" src="/js/src/js.cookie.js?v=6.4.0"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=6.4.0"></script></body></html>